
## Общее описание

Приложение представляет собой инфраструктурный компонент для асинхронной оркестрации задач произвольного типа. Система построена по событийной модели и предназначена для работы в микросервисной среде.

Задачи подключаются к платформе в виде плагинов: каждая задача реализует заранее определённый контракт и регистрируется в рантайме через специализированный сервис. Задачи могут принимать входные данные в виде файлов и/или JSON-структур. Результаты выполнения возвращаются в тех же форматах.

Платформа берёт на себя управление жизненным циклом задач, передачу и хранение файлов, валидацию входных данных, а также уведомление клиентов о текущем статусе выполнения.

---

## Функциональные требования

Система должна обеспечивать:

- создание и регистрацию задач;
    
- хранение и управление состоянием задач;
    
- централизованную работу с файлами (загрузка, хранение, доступ);
    
- асинхронное уведомление клиентов о статусе и результатах выполнения задач.
    

---

## Архитектура системы

Система состоит из набора слабо связанных сервисов, взаимодействующих между собой через API и брокер сообщений.  
[Архитектура](docs/images/architecture.svg)  
[Поток обработки задач](docs/images/sequence.svg)

### API Gateway

Стек:

- Java 17+

- Spring Boot

- Springdoc OpenAPI (Swagger)

- WebClient

- Jackson

Служит точкой входа для внешних клиентов.

Основные обязанности:

- приём запросов на создание задач;
    
- взаимодействие с `Task Manager` для регистрации новой задачи;
    
- взаимодействие с `Storage Gateway` для генерации presigned-ссылок на загрузку файлов;
    
- не хранит состояние задач.
    

---

### Storage Gateway

Стек:

- Go 1.22+

- Gin

- minio/minio-go


Отвечает за работу с объектным хранилищем.

Основные обязанности:

- генерация presigned URL для загрузки файлов в S3-совместимое хранилище.
    

---

### Storage Notification
Стек:
- Go 1.22+

- Gin

- segmentio/kafka-go  

Обрабатывает события, связанные с загрузкой файлов.

Основные обязанности:

- публикация уведомлений о завершении загрузки файлов в Kafka-топик `upload_files`.
    

---

### Task Manager
Стек:

- Go 1.22+

- Gin

- segmentio/kafka-go  

- mongodb/mongo-go-driver

Центральный сервис управления задачами (master-сервис).

Основные обязанности:

- хранение состояния и метаданных задач;
    
- обработка событий из Kafka:
    
    - `upload_files` — сигнал о завершении загрузки входных файлов;
        
    - `task_result` — сигнал о завершении обработки задачи;
        
- публикация сообщений о готовности задач к обработке в Kafka-топик `tasks`.
    

---

### Task Dispatcher

Стек:

- Go 1.22+

- Gin

- segmentio/kafka-go  

Отвечает за распределение задач между обработчиками.

Основные обязанности:

- подписка на Kafka-топик `tasks`;
    
- маршрутизация задач к соответствующим обработчикам на основе типа задачи и доступных исполнителей.
    

---

### Handler Manager

Стек:

- Go 1.22+

- Gin

- mongodb/mongo-go-driver

Сервис управления обработчиками задач.

Основные обязанности:

- регистрация обработчиков в системе;
    
- хранение информации об обработчиках (адреса, поддерживаемые типы задач);
    
- хранение и управление схемами входных данных;
    
- валидация входных запросов задач по соответствующим схемам перед передачей в обработчик.

### Apache Kafka
Асинхронная координация сервисов и событийная шина системы.

Топики:

**tasks** — регистрация и запуск задач

**upload_files** — уведомления о загрузке файлов

**task_result** — результаты выполнения задач

### MongoDB

Хранение задач и схем валидации для обработчиков

### Redis

Источник правды о доступных обработчиках и их целевом эндпоинте

---

### Общая идея потока данных

1. Клиент создаёт задачу через API Gateway.
    
2. Gateway регистрирует задачу и предоставляет ссылки для загрузки файлов.
    
3. Клиент загружает файлы напрямую в хранилище.
    
4. Storage Notification публикует событие о загрузке файла.
    
5. Task Manager обновляет состояние задачи и инициирует её обработку.
    
6. Task Dispatcher направляет задачу соответствующему обработчику. Если входные данные включают результат - обращается к storage-gateway за ссылкой.
    
7. Обработчик выполняет задачу и публикует результат.
    
8. Клиент получает уведомление о статусе и результатах выполнения.
    
### Технологический стек

